import{_ as W,c as _,a as e,F as A,r as L,b as I,t as i,u as p,i as y,w as k,v as ee,d as te,o as m,e as u,f as K,M as Q,g as F,h as se,j as oe,s as R,k as le,l as z,m as ne,n as G,p as X,q as Y,x as J,y as ae,z as V,A as E,B as de,C as U,D as ie,E as ue,G as ce,H as q,I as re,T as ve,J as me}from"./index-GpWfpQeN.js";const be={class:"card"},fe={class:"list-group list-group-flush"},pe={class:"row mb-2"},_e={class:"col-8 fw-bolder"},ge={class:"col-4 text-end"},xe=["disabled","onClick"],ye={class:"row"},ke={class:"col-9 ps-4 text-body-secondary"},$e={class:"custom-info"},he={class:"ps-3"},Me={class:"col-3 text-end"},Ce={class:"card-footer"},Ie={class:"row text-body fw-semibold"},we={class:"col text-end"},Te={__name:"CartItemList",emits:["editProduct"],setup(N,{emit:$}){const c=$,a=y("cartData"),g=y("diningFinished");function b(n){const o=n.mealObject,l=n.dateTime,r={setMenuRadio:n.setMenuObject.setMenuId,spicy:n.spicyObject.value,extra:n.extraObject.value,notes:n.notes,count:n.count};c("editProduct",{mealItem:o,options:r,dateTime:l})}return(n,o)=>(m(),_("div",be,[e("ul",fe,[(m(!0),_(A,null,L(p(a),l=>(m(),_("li",{key:l.dateTime,class:"list-group-item"},[e("div",pe,[e("div",_e,[I(i(l.mealObject.strMeal)+" ",1),o[0]||(o[0]=e("br",null,null,-1)),I(" "+i(`×${l.count}`),1)]),e("div",ge,[e("button",{type:"button",class:"btn btn-outline-rosewood","data-bs-toggle":"modal","data-bs-target":"#editModal",disabled:p(g),onClick:r=>b(l)}," 編輯 ",8,xe)])]),e("div",ye,[e("div",ke,[e("div",$e,[e("span",null,i(l.setMenuObject.setMenuName),1),e("span",null,i(l.spicyObject.name),1),k(e("span",null,i(l.extraObject.name),513),[[ee,l.extraObject.name]])]),e("div",null,[e("details",null,[o[1]||(o[1]=e("summary",null,"備註",-1)),e("div",he,i(l.notes||"無"),1)])])]),e("div",Me,[e("b",null,i(`$${l.subtotal}`),1)])])]))),128))]),e("div",Ce,[e("div",Ie,[o[3]||(o[3]=e("div",{class:"col"},"小計",-1)),e("div",we,[te(n.$slots,"default",{},()=>[o[2]||(o[2]=I("未計算"))])])])])]))}},De=W(Te,[["__scopeId","data-v-98084daf"]]),Ee={class:"modal-dialog"},Ne={class:"modal-content"},Pe={class:"modal-body"},je={class:"row"},Be={class:"col-8"},Oe={class:"col-4 text-end"},Se=["id","value"],Re=["for"],Ve={class:"row"},Ue={class:"col-8"},Ae={class:"col-4 text-end"},Le={class:"row"},Fe={class:"col"},Ge=["id","value"],He=["for"],ze={class:"form-check"},Je={class:"form-check-label d-block",for:"extraCheckbox_E"},qe={class:"row"},We={class:"col-4 text-end"},Ke={class:"row gx-0"},Qe={class:"col-2 text-center"},Xe=["disabled"],Ye={class:"col-4"},Ze={class:"text-end h5 mt-3"},et=25,tt={__name:"EditWindow",props:["cartItemPropped"],setup(N,{expose:$}){const c=y("emitter"),a=N,g=[{value:"no",name:"不辣"},{value:"mild",name:"微辣"},{value:"mildMedium",name:"小辣"},{value:"medium",name:"中辣"},{value:"hot",name:"大辣"}],b=u(null),n=u(null);K(()=>{n.value=new Q(b.value,{backdrop:"static",keyboard:!1})}),F(()=>{n.value.hide()}),$({modalInstance:n,clearSettings:l});const o=u({setMenuRadio:"No",spicy:"no",extra:!1,notes:"",count:0});function l(){o.value={setMenuRadio:"No",spicy:"no",extra:!1,notes:"",count:0},f.value=!1}const r=u({});function B(){r.value=a.cartItemPropped.mealItem}function w(){o.value=a.cartItemPropped.options}se(()=>{B(),w()});const P=oe(()=>{const d=r.value.price;let t=0;t=R.find(M=>M.setMenuId===o.value.setMenuRadio).setMenuPrice;const s=o.value.extra?25:0,x=o.value.count;return(d+t+s)*x}),f=u(!1);function C(){let d=o.value.count;d++,o.value.count=d,v()}function j(){let d=o.value.count;d--,d<1&&(d=1),o.value.count=d,v()}function v(){o.value.count<1||o.value.count%1!==0?f.value=!0:f.value=!1}const h=y("cartData");function O(){if(v(),f.value)return;const d={...r.value};let t={};t={...R.find(D=>D.setMenuId===o.value.setMenuRadio)};let s={};s={...g.find(D=>D.value===o.value.spicy)};const x={value:o.value.extra,price:o.value.extra?25:0,name:o.value.extra?"加量":""},M=a.cartItemPropped.dateTime,H={mealObject:d,setMenuObject:t,spicyObject:s,extraObject:x,notes:o.value.notes,count:o.value.count,subtotal:P.value,dateTime:M};h.value.forEach((D,Z)=>{D.dateTime===H.dateTime&&h.value.splice(Z,1,H)}),n.value.hide(),l()}function S(){c.emit("deleteItem",r.value),f.value=!1}function T(){const d=a.cartItemPropped.dateTime;h.value.forEach((t,s)=>{t.dateTime===d&&h.value.splice(s,1)})}return c.on("cancelDeleting",v),c.on("confirmDeleting",T),le(()=>{c.off("cancelDeleting"),c.off("confirmDeleting")}),(d,t)=>(m(),_("div",{id:"editModal",ref_key:"modal",ref:b,class:"modal fade",tabindex:"-1"},[e("div",Ee,[e("div",Ne,[e("div",{class:"modal-header"},[t[5]||(t[5]=e("h1",{class:"modal-title fs-5"},"編輯餐點",-1)),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal",onClick:l})]),e("form",null,[e("div",Pe,[e("div",je,[e("h2",Be,i(r.value.strMeal),1),e("div",Oe,i(`NT$ ${r.value.price}`),1)]),e("fieldset",null,[t[6]||(t[6]=e("legend",{class:"col-form-label"},"套餐",-1)),(m(!0),_(A,null,L(p(R),s=>(m(),_("div",{key:s.setMenuId,class:"form-check"},[k(e("input",{id:`${s.setMenuId}_E`,"onUpdate:modelValue":t[0]||(t[0]=x=>o.value.setMenuRadio=x),class:"form-check-input",type:"radio",value:s.setMenuId},null,8,Se),[[z,o.value.setMenuRadio]]),e("label",{class:"form-check-label d-block",for:`${s.setMenuId}_E`},[e("div",Ve,[e("div",Ue,i(s.setMenuName),1),e("div",Ae,i(`+ ${s.setMenuPrice} 元`),1)]),e("div",Le,[e("div",Fe,i(s.setMenuDescription),1)])],8,Re)]))),128))]),e("fieldset",null,[t[7]||(t[7]=e("legend",{class:"col-form-label"},"辣度",-1)),(m(),_(A,null,L(g,s=>e("div",{key:s.value,class:"form-check form-check-inline"},[k(e("input",{id:`${s.value}_E`,"onUpdate:modelValue":t[1]||(t[1]=x=>o.value.spicy=x),class:"form-check-input",type:"radio",value:s.value},null,8,Ge),[[z,o.value.spicy]]),e("label",{class:"form-check-label",for:`${s.value}_E`},i(s.name),9,He)])),64))]),e("fieldset",null,[t[9]||(t[9]=e("legend",{class:"col-form-label"},"加量",-1)),e("div",ze,[k(e("input",{id:"extraCheckbox_E","onUpdate:modelValue":t[2]||(t[2]=s=>o.value.extra=s),class:"form-check-input",type:"checkbox"},null,512),[[ne,o.value.extra]]),e("label",Je,[e("div",qe,[t[8]||(t[8]=e("div",{class:"col-8"},"是",-1)),e("div",We,i(`+ ${et} 元`),1)])])])]),e("fieldset",null,[t[10]||(t[10]=e("label",{for:"notesText_E",class:"col-form-label"},"備註",-1)),k(e("textarea",{id:"notesText_E","onUpdate:modelValue":t[3]||(t[3]=s=>o.value.notes=s),class:"form-control",rows:"3"},null,512),[[G,o.value.notes,void 0,{lazy:!0}]])]),e("fieldset",null,[t[14]||(t[14]=e("label",{class:"col-form-label",for:"count_E"},"數量",-1)),e("div",Ke,[e("div",Qe,[e("button",{type:"button",class:"btn border-0",disabled:o.value.count<=1,onClick:j},t[11]||(t[11]=[e("i",{class:"bi bi-dash-lg"},null,-1)]),8,Xe)]),e("div",Ye,[k(e("input",X({id:"count_E","onUpdate:modelValue":t[4]||(t[4]=s=>o.value.count=s),class:["form-control",{"is-invalid":f.value}],type:"number",min:"1"},Y({input:v,focusout:v})),null,16),[[G,o.value.count,void 0,{number:!0}]]),t[12]||(t[12]=e("div",{class:"invalid-feedback"},"請輸入正整數",-1))]),e("div",{class:"col-2 text-center"},[e("button",{type:"button",class:"btn",onClick:C},t[13]||(t[13]=[e("i",{class:"bi bi-plus-lg"},null,-1)]))])])]),e("p",Ze,i(`小計：NT$ ${P.value} 元`),1)]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-danger me-auto px-3","data-bs-target":"#deleteModel","data-bs-toggle":"modal",onClick:S}," 刪除 "),e("button",{type:"button",class:"btn btn-outline-rosewood","data-bs-dismiss":"modal",onClick:l}," 取消 "),e("button",{type:"button",class:"btn btn-rosewood",onClick:O},"確認編輯")])])])])],512))}},st={class:"modal-dialog modal-dialog-centered modal-sm-unresponsive"},ot={class:"modal-content"},lt={class:"modal-body text-center",style:{padding:"1.5rem 1.5rem 1rem"}},nt={class:"mb-0 text-body-secondary"},at={__name:"DeleteModal",setup(N,{expose:$}){const c=y("emitter"),a=u({});c.on("deleteItem",l=>{a.value=l}),F(()=>{c.off("deleteItem")});const g=u(null),b=u(null);K(()=>{b.value=new Q(g.value)}),F(()=>{b.value.hide()}),$({modalInstance:b});function n(){c.emit("cancelDeleting")}function o(){c.emit("confirmDeleting")}return(l,r)=>(m(),_("div",{id:"deleteModel",ref_key:"modal",ref:g,class:"modal fade",tabindex:"-1"},[e("div",st,[e("div",ot,[e("div",lt,[r[0]||(r[0]=e("h1",{class:"fs-5"},"確定要刪除此品項嗎？",-1)),e("p",nt,i(a.value.strMeal),1)]),e("div",{class:"modal-footer justify-content-evenly border-top-0"},[e("button",{class:"btn btn-outline-secondary","data-bs-target":"#editModal","data-bs-toggle":"modal",onClick:n}," 返回編輯 "),e("button",{class:"btn btn-danger","data-bs-dismiss":"modal",onClick:o}," 確定刪除 ")])])])],512))}},dt={class:"container px-4 py-3"},it={key:0,class:"mb-2"},ut={class:"row mb-3 gx-0"},ct={class:"col col-lg-5"},rt=["disabled"],vt={class:"row gx-0"},mt={class:"col-2 text-center col-lg-1"},bt=["disabled"],ft={class:"col-3"},pt=["disabled"],_t={class:"col-2 text-center col-lg-1"},gt=["disabled"],xt={key:1},yt={class:"text-center"},kt=["disabled"],$t={__name:"CartPage",setup(N){const $=me(),c=y("diningFinished"),a=y("cartData"),g=y("orderHistory"),b=u(!1),n=u(!1);J(()=>!!g.value.length,t=>{b.value=t,n.value=t},{immediate:!0});const o=y("guestsCount"),l=y("tableNumber");function r(){let t=o.value;t++,o.value=t,v()}function B(){let t=o.value;t--,t<1&&(t=1),o.value=t,v()}const w=u(0);J(a,P,{immediate:!0,deep:!0});function P(){let t=0;a.value.forEach(s=>{t+=s.subtotal}),w.value=t}const f=u(!1),C=u(!1);function j(){l.value?f.value=!1:f.value=!0}function v(){o.value<1||o.value%1!==0?C.value=!0:C.value=!1}const h=u({});function O(t){h.value=t}function S(){if(j(),v(),f.value||C.value)return;const t={cart:a.value,cartSubtotal:w.value,tableNumber:l.value,guestsCount:o.value,dateTime:Date.now()},s=JSON.parse(JSON.stringify(t));g.value.push(s),a.value.length=0,$.push("/order-history")}const T=u(null),d=u(null);return ae(()=>{if(document.getElementById("editModal").classList.contains("show")||document.getElementById("deleteModel").classList.contains("show"))return T.value.modalInstance.hide(),d.value.modalInstance.hide(),T.value.clearSettings(),!1}),(t,s)=>{const x=ie("RouterLink");return m(),_("div",dt,[p(a).length?(m(),_("p",it,[E(x,{to:"/",class:"text-decoration-none text-roast-brown fw-semibold"},{default:U(()=>s[2]||(s[2]=[I("回菜單←")])),_:1})])):V("",!0),e("form",null,[e("div",ut,[s[5]||(s[5]=e("div",{class:"col"},[e("label",{for:"tableNumberSelect",class:"col-form-label"},"內用桌號")],-1)),e("div",ct,[k(e("select",{id:"tableNumberSelect","onUpdate:modelValue":s[0]||(s[0]=M=>q(l)?l.value=M:null),class:ce(["form-select",{"is-invalid":f.value}]),onChange:j,disabled:b.value},s[3]||(s[3]=[re('<option value="" disabled data-v-a77c7698>請選擇桌號</option><option value="A1" data-v-a77c7698>A1</option><option value="A2" data-v-a77c7698>A2</option><option value="A3" data-v-a77c7698>A3</option><option value="B1" data-v-a77c7698>B1</option><option value="B2" data-v-a77c7698>B2</option>',6)]),42,rt),[[ue,p(l)]]),s[4]||(s[4]=e("div",{class:"invalid-feedback"},"請選擇您的桌號。",-1))])]),e("div",vt,[s[9]||(s[9]=e("div",{class:"col"},[e("label",{for:"guestsCountInput",class:"col-form-label"},"用餐人數")],-1)),e("div",mt,[e("button",{type:"button",title:"減少",class:"btn border-0",disabled:p(o)<=1||n.value,onClick:B},s[6]||(s[6]=[e("i",{class:"bi bi-dash-lg"},null,-1)]),8,bt)]),e("div",ft,[k(e("input",X({id:"guestsCountInput","onUpdate:modelValue":s[1]||(s[1]=M=>q(o)?o.value=M:null),type:"number",min:"1",class:["form-control",{"is-invalid":C.value}]},Y({input:v,focusout:v}),{disabled:n.value}),null,16,pt),[[G,p(o),void 0,{number:!0}]]),s[7]||(s[7]=e("div",{class:"invalid-feedback"},"請輸入有效人數",-1))]),e("div",_t,[e("button",{type:"button",title:"增加",class:"btn border-0",disabled:n.value,onClick:r},s[8]||(s[8]=[e("i",{class:"bi bi-plus-lg"},null,-1)]),8,gt)])])]),s[12]||(s[12]=e("hr",null,null,-1)),p(a).length?V("",!0):(m(),_("div",xt,[s[11]||(s[11]=e("h1",{class:"text-center text-body-tertiary mt-4"},"尚未加入餐點",-1)),e("p",yt,[E(x,{to:"/",title:"首頁",class:"text-body-tertiary"},{default:U(()=>s[10]||(s[10]=[I("點餐去")])),_:1})])])),E(tt,{ref_key:"editModal",ref:T,cartItemPropped:h.value},null,8,["cartItemPropped"]),E(at,{ref_key:"deleteModal",ref:d},null,512),p(a).length?(m(),de(De,{key:2,onEditProduct:O},{default:U(()=>[I(i(`NT$${w.value}`),1)]),_:1})):V("",!0),e("button",{type:"button",class:"btn btn-warning fixed-bottom btn-lg btn-wine-red",disabled:p(c)||!p(a).length,onClick:S}," 送出訂單 ",8,kt),E(ve)])}}},Mt=W($t,[["__scopeId","data-v-a77c7698"]]);export{Mt as default};
